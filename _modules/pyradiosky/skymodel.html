
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>pyradiosky.skymodel &#8212; pyradiosky 0.1.dev1+ge273795.add.rtd documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pyradiosky.skymodel</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- mode: python; coding: utf-8 -*</span>
<span class="c1"># Copyright (c) 2019 Radio Astronomy Software Group</span>
<span class="c1"># Licensed under the 3-clause BSD License</span>
<span class="sd">&quot;&quot;&quot;Define SkyModel class and helper functions.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">orthogonal_procrustes</span> <span class="k">as</span> <span class="n">ortho_procr</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">EarthLocation</span><span class="p">,</span> <span class="n">AltAz</span><span class="p">,</span> <span class="n">Latitude</span><span class="p">,</span> <span class="n">Longitude</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">units</span>
<span class="kn">from</span> <span class="nn">astropy.units</span> <span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">votable</span>
<span class="kn">from</span> <span class="nn">pyuvdata.uvbase</span> <span class="kn">import</span> <span class="n">UVBase</span>
<span class="kn">from</span> <span class="nn">pyuvdata.parameter</span> <span class="kn">import</span> <span class="n">UVParameter</span>
<span class="kn">import</span> <span class="nn">pyuvdata.utils</span> <span class="k">as</span> <span class="nn">uvutils</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyuvdata.uvbeam.cst_beam</span> <span class="kn">import</span> <span class="n">CSTBeam</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="c1"># backwards compatility for older pyuvdata versions</span>
    <span class="kn">from</span> <span class="nn">pyuvdata.cst_beam</span> <span class="kn">import</span> <span class="n">CSTBeam</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">skyutils</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">spherical_coords_transforms</span> <span class="k">as</span> <span class="n">sct</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__version__</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;hasmoon&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SkyModel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;read_healpix_hdf5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;healpix_to_sky&quot;</span><span class="p">,</span>
    <span class="s2">&quot;skymodel_to_array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;array_to_skymodel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source_cuts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;read_gleam_catalog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;read_votable_catalog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;read_text_catalog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;read_idl_catalog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;write_catalog_to_file&quot;</span><span class="p">,</span>
    <span class="s2">&quot;write_healpix_hdf5&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">lunarsky</span> <span class="kn">import</span> <span class="n">SkyCoord</span><span class="p">,</span> <span class="n">MoonLocation</span><span class="p">,</span> <span class="n">LunarTopo</span>

    <span class="n">hasmoon</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>

    <span class="n">hasmoon</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">class</span> <span class="nc">MoonLocation</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">class</span> <span class="nc">LunarTopo</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="c1"># Nov 5 2019 notes</span>
<span class="c1">#    Read/write methods to add:</span>
<span class="c1">#        FHD save file -- (read only)</span>
<span class="c1">#        VOTable -- (needs a write method)</span>
<span class="c1">#        HDF5 HEALPix --- (needs a write method)</span>
<span class="c1">#        HEALPix fits files</span>

<span class="c1">#    Convert stokes and coherency to Astropy quantities.</span>


<span class="k">class</span> <span class="nc">TelescopeLocationParameter</span><span class="p">(</span><span class="n">UVParameter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">_get_matching_fields</span><span class="p">(</span>
    <span class="n">name_to_match</span><span class="p">,</span> <span class="n">name_list</span><span class="p">,</span> <span class="n">exclude_start_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">brittle</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
    <span class="n">match_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">name_list</span> <span class="k">if</span> <span class="n">name_to_match</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># try requiring exact match</span>
        <span class="n">match_list_temp</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">match_list</span> <span class="k">if</span> <span class="n">name_to_match</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_list_temp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">match_list</span> <span class="o">=</span> <span class="n">match_list_temp</span>
        <span class="k">elif</span> <span class="n">exclude_start_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># try excluding columns which start with exclude_start_pattern</span>
            <span class="n">match_list_temp</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">name</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">match_list</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">exclude_start_pattern</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_list_temp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">match_list</span> <span class="o">=</span> <span class="n">match_list_temp</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">brittle</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;More than one match for </span><span class="si">{</span><span class="n">name_to_match</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">name_list</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">match_list</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">brittle</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No match for </span><span class="si">{</span><span class="n">name_to_match</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">name_list</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">match_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<div class="viewcode-block" id="SkyModel"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel">[docs]</a><span class="k">class</span> <span class="nc">SkyModel</span><span class="p">(</span><span class="n">UVBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object to hold point source and diffuse models.</span>

<span class="sd">    Defines a set of components at given ICRS ra/dec coordinates,</span>
<span class="sd">    with flux densities defined by stokes parameters.</span>

<span class="sd">    Flux densities defined are by stokes parameters.</span>
<span class="sd">    The attribute Ncomponents gives the number of source components.</span>

<span class="sd">    Contains methods to:</span>
<span class="sd">        - Read and write different catalog formats.</span>
<span class="sd">        - Calculate source positions.</span>
<span class="sd">        - Calculate local coherency matrix in a local topocentric frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : array_like of str</span>
<span class="sd">        Unique identifier for each source component, shape (Ncomponents,).</span>
<span class="sd">        Not used if nside is set.</span>
<span class="sd">    ra : :class:`astropy.Longitude`</span>
<span class="sd">        source RA in J2000 (or ICRS) coordinates, shape (Ncomponents,).</span>
<span class="sd">    dec : :class:`astropy.Latitude`</span>
<span class="sd">        source Dec in J2000 (or ICRS) coordinates, shape (Ncomponents,).</span>
<span class="sd">    stokes : array_like of float</span>
<span class="sd">        4 element vector giving the source [I, Q, U, V], shape (4, Nfreqs, Ncomponents).</span>
<span class="sd">    spectral_type : str</span>
<span class="sd">        Indicates how fluxes should be calculated at each frequency.</span>

<span class="sd">        Options:</span>

<span class="sd">        - &#39;flat&#39; : Flat spectrum.</span>
<span class="sd">        - &#39;full&#39; : Flux is defined by a saved value at each frequency.</span>
<span class="sd">        - &#39;subband&#39; : Flux is given at a set of band centers.</span>
<span class="sd">        - &#39;spectral_index&#39; : Flux is given at a reference frequency.</span>

<span class="sd">    freq_array : :class:`astropy.Quantity`</span>
<span class="sd">        Array of frequencies that fluxes are provided for, shape (Nfreqs,).</span>
<span class="sd">    reference_frequency : :class:`astropy.Quantity`</span>
<span class="sd">        Reference frequencies of flux values, shape (Ncomponents,).</span>
<span class="sd">    spectral_index : array_like of float</span>
<span class="sd">        Spectral index of each source, shape (Ncomponents).</span>
<span class="sd">        None if spectral_type is not &#39;spectral_index&#39;.</span>
<span class="sd">    nside : int</span>
<span class="sd">        nside parameter for HEALPix maps.</span>
<span class="sd">    hpx_inds : array_like of int</span>
<span class="sd">        Indices for HEALPix maps, only used if nside is set.</span>
<span class="sd">    pos_tol : float</span>
<span class="sd">        position tolerance in degrees, defaults to minimum float in numpy</span>
<span class="sd">        position tolerance in degrees</span>
<span class="sd">    extended_model_group : array_like of int</span>
<span class="sd">        Identifier that groups components of an extended source model.</span>
<span class="sd">        -1 for point sources, shape (Ncomponents,).</span>
<span class="sd">    beam_amp : array_like of float</span>
<span class="sd">        Beam amplitude at the source position, shape (4, Nfreqs, Ncomponents).</span>
<span class="sd">        4 element vector corresponds to [XX, YY, XY, YX] instrumental</span>
<span class="sd">        polarizations.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stokes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">spectral_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">freq_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reference_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">spectral_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nside</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">hpx_inds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pos_tol</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
        <span class="n">extended_model_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">beam_amp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># standard angle tolerance: 1 mas in radians.</span>
        <span class="n">angle_tol</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">future_angle_tol</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Ncomponents</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;Ncomponents&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Number of components&quot;</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="nb">int</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Number of frequencies if spectral_type  is &#39;full&#39; or &#39;subband&#39;, &quot;</span>
            <span class="s2">&quot;1 otherwise.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Nfreqs</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span><span class="s2">&quot;Nfreqs&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Right ascension of components in ICRS coordinates.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ra</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">Longitude</span><span class="p">,</span>
            <span class="n">tols</span><span class="o">=</span><span class="n">angle_tol</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Declination of components in ICRS coordinates.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dec</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;dec&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">Latitude</span><span class="p">,</span>
            <span class="n">tols</span><span class="o">=</span><span class="n">angle_tol</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Type of component, options are: &#39;healpix&#39;, &#39;point&#39;. &quot;</span>
            <span class="s2">&quot;If component_type is &#39;healpix&#39;, the components are the pixels in a &quot;</span>
            <span class="s2">&quot;HEALPix map. If the component_type is &#39;point&#39;, the components are&quot;</span>
            <span class="s2">&quot;point-like sources.&quot;</span>
            <span class="s2">&quot;Determines which parameters are required.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_type</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;component_type&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">acceptable_vals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;healpix&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Component name, not required for HEALPix maps.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Healpix nside, only reqired for HEALPix maps.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nside</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;nside&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Healpix index, only reqired for HEALPix maps.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hpx_inds</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;hpx_inds&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Frequency array in Hz, only required if spectral_type is &#39;full&#39; or &#39;subband&#39;.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq_array</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;freq_array&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Nfreqs&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">Quantity</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Reference frequency in Hz, only required if spectral_type is &#39;spectral_index&#39;.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reference_frequency</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;reference_frequency&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">Quantity</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Component flux per frequency and Stokes parameter&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stokes</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;stokes&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Nfreqs&quot;</span><span class="p">,</span> <span class="s2">&quot;Ncomponents&quot;</span><span class="p">),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># The coherency is a 2x2 matrix giving electric field correlation in Jy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coherency_radec</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;coherency_radec&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ra/Dec coherency per component&quot;</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Nfreqs&quot;</span><span class="p">,</span> <span class="s2">&quot;Ncomponents&quot;</span><span class="p">),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Type of spectral flux specification, options are: &quot;</span>
            <span class="s2">&quot;&#39;full&#39;,&#39;flat&#39;, &#39;subband&#39;, &#39;spectral_index&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spectral_type</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;spectral_type&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">acceptable_vals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="s2">&quot;subband&quot;</span><span class="p">,</span> <span class="s2">&quot;spectral_index&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_spectral_index</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;spectral_index&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Spectral indexm only required if spectral_type is &#39;spectral_index&#39;.&quot;</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_beam_amp</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;beam_amp&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;Beam amplitude at the source position as a function &quot;</span>
                <span class="s2">&quot;of instrument polarization and frequency.&quot;</span>
            <span class="p">),</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Nfreqs&quot;</span><span class="p">,</span> <span class="s2">&quot;Ncomponents&quot;</span><span class="p">),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_extended_model_group</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;extended_model_group&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;Identifier that groups components of an extended &quot;</span>
                <span class="s2">&quot;source model. Set to -1 for point sources.&quot;</span>
            <span class="p">),</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Time for local position calculations.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Telescope Location for local position calculations.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_telescope_location</span> <span class="o">=</span> <span class="n">TelescopeLocationParameter</span><span class="p">(</span>
            <span class="s2">&quot;telescope_location&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">EarthLocation</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">hasmoon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_telescope_location</span><span class="o">.</span><span class="n">expected_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">EarthLocation</span><span class="p">,</span> <span class="n">MoonLocation</span><span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Altitude and Azimuth of components in local coordinates.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alt_az</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;alt_az&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Ncomponents&quot;</span><span class="p">),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">tols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Position cosines of components in local coordinates.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pos_lmn</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;pos_lmn&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Ncomponents&quot;</span><span class="p">),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">tols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Boolean indicator of whether this source is above the horizon&quot;</span>
            <span class="s2">&quot;at the current time.&quot;</span>
            <span class="s2">&quot;True indicates the source is above the horizon.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_above_horizon</span> <span class="o">=</span> <span class="n">UVParameter</span><span class="p">(</span>
            <span class="s2">&quot;above_horizon&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ncomponents&quot;</span><span class="p">,),</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># initialize the underlying UVBase properties</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SkyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># String to add to history of any files written with this version of pyuvdata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyradiosky_version_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;  Read/written with pyradiosky version: &quot;</span> <span class="o">+</span> <span class="n">__version__</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">nside</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_component_type_params</span><span class="p">(</span><span class="s2">&quot;healpix&quot;</span><span class="p">)</span>
            <span class="n">req_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nside&quot;</span><span class="p">,</span> <span class="s2">&quot;hpx_inds&quot;</span><span class="p">,</span> <span class="s2">&quot;stokes&quot;</span><span class="p">,</span> <span class="s2">&quot;spectral_type&quot;</span><span class="p">]</span>
            <span class="n">args_set_req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">nside</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">hpx_inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">stokes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">spectral_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_component_type_params</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">)</span>
            <span class="n">req_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;stokes&quot;</span><span class="p">,</span> <span class="s2">&quot;spectral_type&quot;</span><span class="p">]</span>
            <span class="n">args_set_req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">dec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">stokes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">spectral_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">arg_set_opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">spectral_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">args_set_req</span><span class="p">,</span> <span class="n">arg_set_opt</span><span class="p">))):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">args_set_req</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;If initializing with values, all of </span><span class="si">{</span><span class="n">req_args</span><span class="si">}</span><span class="s2"> must be set.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_type</span> <span class="o">==</span> <span class="s2">&quot;healpix&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">astropy_healpix</span>
                <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                        <span class="s2">&quot;The astropy-healpix module must be installed to use HEALPix methods&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nside</span> <span class="o">=</span> <span class="n">nside</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hpx_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">hpx_inds</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpx_inds</span><span class="o">.</span><span class="n">size</span>
                <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">astropy_healpix</span><span class="o">.</span><span class="n">healpix_to_lonlat</span><span class="p">(</span><span class="n">hpx_inds</span><span class="p">,</span> <span class="n">nside</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="n">ra</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="n">dec</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>

            <span class="c1"># handle old parameter order</span>
            <span class="c1"># (use to be: name, ra, dec, stokes, freq_array spectral_type)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spectral_type</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;The input parameters to SkyModel.__init__ have changed. Please &quot;</span>
                    <span class="s2">&quot;update the call.&quot;</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">freqs_use</span> <span class="o">=</span> <span class="n">spectral_type</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="n">freq_array</span>

                <span class="k">if</span> <span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;flat&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">freqs_use</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">reference_frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                    <span class="n">reference_frequency</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">freqs_use</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">freq_array</span> <span class="o">=</span> <span class="n">freqs_use</span>
                    <span class="n">reference_frequency</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set_spectral_type_params</span><span class="p">(</span><span class="n">spectral_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq_array</span><span class="p">,</span> <span class="p">(</span><span class="n">Quantity</span><span class="p">,)):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;In the future, the freq_array will be required to be an &quot;</span>
                        <span class="s2">&quot;astropy Quantity with units that are convertable to Hz. &quot;</span>
                        <span class="s2">&quot;Currently, floats are assumed to be in Hz.&quot;</span><span class="p">,</span>
                        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">freq_array</span> <span class="o">=</span> <span class="n">freq_array</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">freq_array</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nfreqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span><span class="o">.</span><span class="n">size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nfreqs</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_frequency</span><span class="p">,</span> <span class="p">(</span><span class="n">Quantity</span><span class="p">,)):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;In the future, the reference_frequency will be required to be an &quot;</span>
                        <span class="s2">&quot;astropy Quantity with units that are convertable to Hz. &quot;</span>
                        <span class="s2">&quot;Currently, floats are assumed to be in Hz.&quot;</span><span class="p">,</span>
                        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">reference_frequency</span> <span class="o">=</span> <span class="n">reference_frequency</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">reference_frequency</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">spectral_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spectral_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">spectral_index</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stokes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nfreqs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_polarized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stokes</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_polarized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polarized</span><span class="o">.</span><span class="n">size</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">coherency_radec</span> <span class="o">=</span> <span class="n">skyutils</span><span class="o">.</span><span class="n">stokes_to_coherency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stokes</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">history</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_spectral_type_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectral_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set parameters depending on spectral_type.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_type</span> <span class="o">=</span> <span class="n">spectral_type</span>

        <span class="k">if</span> <span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;spectral_index&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spectral_index</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_frequency</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Nfreqs</span><span class="o">.</span><span class="n">acceptable_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_freq_array</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">spectral_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="s2">&quot;subband&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_freq_array</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spectral_index</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_frequency</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Nfreqs</span><span class="o">.</span><span class="n">acceptable_vals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;flat&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_freq_array</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spectral_index</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_frequency</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Nfreqs</span><span class="o">.</span><span class="n">acceptable_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="SkyModel.set_spectral_type_params"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.set_spectral_type_params">[docs]</a>    <span class="k">def</span> <span class="nf">set_spectral_type_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectral_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set parameters depending on spectral_type.</span>

<span class="sd">        Deprecated, use _set_spectral_type_params</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;This function is deprecated, use `_set_spectral_type_params` instead.&quot;</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_spectral_type_params</span><span class="p">(</span><span class="n">spectral_type</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_set_component_type_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set parameters depending on component_type.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_type</span> <span class="o">=</span> <span class="n">component_type</span>

        <span class="k">if</span> <span class="n">component_type</span> <span class="o">==</span> <span class="s2">&quot;healpix&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hpx_inds</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nside</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hpx_inds</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nside</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SkyModel.check"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that all required parameters are set reasonably.</span>

<span class="sd">        Check that required parameters exist and have appropriate shapes.</span>
<span class="sd">        Optionally check if the values are acceptable.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones.</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check if values in required parameters are acceptable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first make sure the required parameters and forms are set properly</span>
        <span class="c1"># for the spectral_type and component_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_spectral_type_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectral_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_component_type_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component_type</span><span class="p">)</span>

        <span class="c1"># make sure only one of freq_array and reference_frequency is defined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only one of freq_array and reference_frequency can be specified, not both.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Run the basic check from UVBase</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SkyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
            <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
        <span class="p">)</span>

        <span class="c1"># make sure freq_array or reference_frequency if present is compatible with Hz</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">UnitConversionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;freq_array must have a unit that can be converted to Hz.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">UnitConversionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;reference_frequency must have a unit that can be converted to Hz.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check for equality, check for future equality.&quot;&quot;&quot;</span>
        <span class="c1"># Run the basic __eq__ from UVBase</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SkyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">)</span>

        <span class="c1"># Issue deprecation warning if ra/decs aren&#39;t close to future_angle_tol levels</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">future_angle_tol</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The _ra parameters are not within the future tolerance. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Left is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="si">}</span><span class="s2">, right is </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">ra</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">future_angle_tol</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The _dec parameters are not within the future tolerance. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Left is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dec</span><span class="si">}</span><span class="s2">, right is </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">dec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">equal</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Future equality does not pass, probably because the &quot;</span>
                <span class="s2">&quot;frequencies were not checked in the deprecated equality checking.&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">equal</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SkyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">check_extra</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">equal</span>

<div class="viewcode-block" id="SkyModel.update_positions"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.update_positions">[docs]</a>    <span class="k">def</span> <span class="nf">update_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">telescope_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the altitude/azimuth positions for source components.</span>

<span class="sd">        From alt/az, calculate direction cosines (lmn)</span>

<span class="sd">        Doesn&#39;t return anything but updates the following attributes in-place:</span>
<span class="sd">        * ``pos_lmn``</span>
<span class="sd">        * ``alt_az``</span>
<span class="sd">        * ``time``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : :class:`astropy.Time`</span>
<span class="sd">            Time to update positions for.</span>
<span class="sd">        telescope_location : :class:`astropy.EarthLocation`</span>
<span class="sd">            Telescope location to update positions for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;time must be an astropy Time object. value was: </span><span class="si">{t}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">telescope_location</span><span class="p">,</span> <span class="p">(</span><span class="n">EarthLocation</span><span class="p">,</span> <span class="n">MoonLocation</span><span class="p">)):</span>

            <span class="n">errm</span> <span class="o">=</span> <span class="s2">&quot;telescope_location must be an :class:`astropy.EarthLocation` object&quot;</span>
            <span class="k">if</span> <span class="n">hasmoon</span><span class="p">:</span>
                <span class="n">errm</span> <span class="o">+=</span> <span class="s2">&quot; or a :class:`lunarsky.MoonLocation` object &quot;</span>
            <span class="n">errm</span> <span class="o">+=</span> <span class="s2">&quot;. &quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">errm</span> <span class="o">+</span> <span class="s2">&quot;value was: </span><span class="si">{al}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">al</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">telescope_location</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="c1"># Don&#39;t repeat calculations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span> <span class="o">==</span> <span class="n">telescope_location</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span> <span class="o">=</span> <span class="n">telescope_location</span>

        <span class="n">skycoord_use</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span><span class="p">,</span> <span class="n">MoonLocation</span><span class="p">):</span>
            <span class="n">source_altaz</span> <span class="o">=</span> <span class="n">skycoord_use</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span>
                <span class="n">LunarTopo</span><span class="p">(</span><span class="n">obstime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source_altaz</span> <span class="o">=</span> <span class="n">skycoord_use</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span>
                <span class="n">AltAz</span><span class="p">(</span><span class="n">obstime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">alt_az</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">source_altaz</span><span class="o">.</span><span class="n">alt</span><span class="o">.</span><span class="n">rad</span><span class="p">,</span> <span class="n">source_altaz</span><span class="o">.</span><span class="n">az</span><span class="o">.</span><span class="n">rad</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alt_az</span> <span class="o">=</span> <span class="n">alt_az</span>

        <span class="n">pos_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">pos_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">pos_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_lmn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos_lmn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_lmn</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pos_l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_lmn</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pos_m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_lmn</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pos_n</span>

        <span class="c1"># Horizon mask:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">above_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span></div>

    <span class="k">def</span> <span class="nf">_calc_average_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the &quot;average&quot; rotation matrix from RA/Dec to AltAz.</span>

<span class="sd">        This gets us close to the right value, then need to calculate a correction</span>
<span class="sd">        for each source separately.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array of floats</span>
<span class="sd">            Rotation matrix that defines the average mapping (RA,Dec) &lt;--&gt; (Alt,Az),</span>
<span class="sd">            shape (3, 3).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># unit vectors to be transformed by astropy</span>
        <span class="n">x_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">y_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">z_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

        <span class="n">axes_icrs</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x_c</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y_c</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="n">z_c</span><span class="p">,</span>
            <span class="n">obstime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span>
            <span class="n">representation_type</span><span class="o">=</span><span class="s2">&quot;cartesian&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">axes_altaz</span> <span class="o">=</span> <span class="n">axes_icrs</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="s2">&quot;altaz&quot;</span><span class="p">)</span>
        <span class="n">axes_altaz</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="s2">&quot;cartesian&quot;</span>

        <span class="sd">&quot;&quot;&quot; This transformation matrix is generally not orthogonal</span>
<span class="sd">            to better than 10^-7, so let&#39;s fix that. &quot;&quot;&quot;</span>

        <span class="n">R_screwy</span> <span class="o">=</span> <span class="n">axes_altaz</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">xyz</span>
        <span class="n">R_really_orthogonal</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ortho_procr</span><span class="p">(</span><span class="n">R_screwy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

        <span class="c1"># Note the transpose, to be consistent with calculation in sct</span>
        <span class="n">R_really_orthogonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">R_really_orthogonal</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">return</span> <span class="n">R_really_orthogonal</span>

    <span class="k">def</span> <span class="nf">_calc_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the true rotation matrix from RA/Dec to AltAz for each component.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inds: array_like, optional</span>
<span class="sd">            Index array to select components. Defaults to all components.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array of floats</span>
<span class="sd">            Rotation matrix that defines the mapping (RA,Dec) &lt;--&gt; (Alt,Az),</span>
<span class="sd">            shape (3, 3, Ncomponents).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">)</span>

        <span class="n">n_inds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>

        <span class="c1"># Find mathematical points and vectors for RA/Dec</span>
        <span class="n">theta_radec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">rad</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
        <span class="n">phi_radec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">rad</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
        <span class="n">radec_vec</span> <span class="o">=</span> <span class="n">sct</span><span class="o">.</span><span class="n">r_hat</span><span class="p">(</span><span class="n">theta_radec</span><span class="p">,</span> <span class="n">phi_radec</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">radec_vec</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">)</span>

        <span class="c1"># Find mathematical points and vectors for Alt/Az</span>
        <span class="n">theta_altaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">inds</span><span class="p">]</span>
        <span class="n">phi_altaz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">inds</span><span class="p">]</span>
        <span class="n">altaz_vec</span> <span class="o">=</span> <span class="n">sct</span><span class="o">.</span><span class="n">r_hat</span><span class="p">(</span><span class="n">theta_altaz</span><span class="p">,</span> <span class="n">phi_altaz</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">altaz_vec</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">)</span>

        <span class="n">R_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_average_rotation_matrix</span><span class="p">()</span>

        <span class="n">R_exact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">src_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span>
            <span class="n">intermediate_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R_avg</span><span class="p">,</span> <span class="n">radec_vec</span><span class="p">[:,</span> <span class="n">src_i</span><span class="p">])</span>

            <span class="n">R_perturb</span> <span class="o">=</span> <span class="n">sct</span><span class="o">.</span><span class="n">vecs2rot</span><span class="p">(</span><span class="n">r1</span><span class="o">=</span><span class="n">intermediate_vec</span><span class="p">,</span> <span class="n">r2</span><span class="o">=</span><span class="n">altaz_vec</span><span class="p">[:,</span> <span class="n">src_i</span><span class="p">])</span>

            <span class="n">R_exact</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">src_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R_perturb</span><span class="p">,</span> <span class="n">R_avg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">R_exact</span>

    <span class="k">def</span> <span class="nf">_calc_coherency_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the rotation matrix to apply to the RA/Dec coherency to get it into alt/az.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inds: array_like, optional</span>
<span class="sd">            Index array to select components.</span>
<span class="sd">            Defaults to all components.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array of floats</span>
<span class="sd">            Rotation matrix that takes the coherency from (RA,Dec) --&gt; (Alt,Az),</span>
<span class="sd">            shape (2, 2, Ncomponents).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">)</span>
        <span class="n">n_inds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>

        <span class="n">basis_rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_rotation_matrix</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>

        <span class="c1"># Find mathematical points and vectors for RA/Dec</span>
        <span class="n">theta_radec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">rad</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
        <span class="n">phi_radec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">rad</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>

        <span class="c1"># Find mathematical points and vectors for Alt/Az</span>
        <span class="n">theta_altaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">inds</span><span class="p">]</span>
        <span class="n">phi_altaz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_az</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">inds</span><span class="p">]</span>

        <span class="n">coherency_rot_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">src_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span>
            <span class="n">coherency_rot_matrix</span><span class="p">[</span>
                <span class="p">:,</span> <span class="p">:,</span> <span class="n">src_i</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">sct</span><span class="o">.</span><span class="n">spherical_basis_vector_rotation_matrix</span><span class="p">(</span>
                <span class="n">theta_radec</span><span class="p">[</span><span class="n">src_i</span><span class="p">],</span>
                <span class="n">phi_radec</span><span class="p">[</span><span class="n">src_i</span><span class="p">],</span>
                <span class="n">basis_rotation_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">src_i</span><span class="p">],</span>
                <span class="n">theta_altaz</span><span class="p">[</span><span class="n">src_i</span><span class="p">],</span>
                <span class="n">phi_altaz</span><span class="p">[</span><span class="n">src_i</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">coherency_rot_matrix</span>

<div class="viewcode-block" id="SkyModel.coherency_calc"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.coherency_calc">[docs]</a>    <span class="k">def</span> <span class="nf">coherency_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deprecated_location</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the local coherency in alt/az basis.</span>

<span class="sd">        :meth:`SkyModel.update_positions` must be run prior to this method.</span>

<span class="sd">        The coherency is a 2x2 matrix giving electric field correlation in Jy.</span>
<span class="sd">        It&#39;s specified on the object as a coherency in the ra/dec basis,</span>
<span class="sd">        but must be rotated into local alt/az.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deprecated_location : :class:`astropy.EarthLocation`</span>
<span class="sd">            This keyword is deprecated. It is preserved to maintain backwards</span>
<span class="sd">            compatibility and sets the EarthLocation on this SkyModel object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array of float</span>
<span class="sd">            local coherency in alt/az basis, shape (2, 2, Nfreqs, Ncomponents)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">above_horizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Horizon cutoff undefined. Assuming all source components &quot;</span>
                <span class="s2">&quot;are above the horizon.&quot;</span>
            <span class="p">)</span>
            <span class="n">above_horizon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">above_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">above_horizon</span>

        <span class="k">if</span> <span class="n">deprecated_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Passing telescope_location to SkyModel.coherency_calc is &quot;</span>
                <span class="s2">&quot;deprecated. Set the telescope_location via SkyModel.update_positions.&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_positions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">deprecated_location</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span><span class="p">,</span> <span class="p">(</span><span class="n">EarthLocation</span><span class="p">,</span> <span class="n">MoonLocation</span><span class="p">)):</span>

            <span class="n">errm</span> <span class="o">=</span> <span class="s2">&quot;telescope_location must be an astropy EarthLocation object&quot;</span>
            <span class="k">if</span> <span class="n">hasmoon</span><span class="p">:</span>
                <span class="n">errm</span> <span class="o">+=</span> <span class="s2">&quot; or a lunarsky MoonLocation object &quot;</span>
            <span class="n">errm</span> <span class="o">+=</span> <span class="s2">&quot;. &quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">errm</span> <span class="o">+</span> <span class="s2">&quot;value was: </span><span class="si">{al}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">al</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telescope_location</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="c1"># Select sources within the horizon only.</span>
        <span class="n">coherency_local</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherency_radec</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">above_horizon</span><span class="p">]</span>

        <span class="c1"># For unpolarized sources, there&#39;s no need to rotate the coherency matrix.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_polarized</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># If there are any polarized sources, do rotation.</span>

            <span class="c1"># This is a boolean array of length len(above_horizon)</span>
            <span class="c1"># that identifies polarized sources above the horizon.</span>
            <span class="n">pol_over_hor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">)[</span><span class="n">above_horizon</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polarized</span>
            <span class="p">)</span>

            <span class="c1"># Indices of polarized sources in the full Ncomponents array,</span>
            <span class="c1"># downselected to those that are above the horizon.</span>
            <span class="n">full_pol_over_hor</span> <span class="o">=</span> <span class="p">[</span><span class="n">pi</span> <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polarized</span> <span class="k">if</span> <span class="n">above_horizon</span><span class="p">[</span><span class="n">pi</span><span class="p">]]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pol_over_hor</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_coherency_rotation</span><span class="p">(</span><span class="n">full_pol_over_hor</span><span class="p">)</span>

                <span class="n">rotation_matrix_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">coherency_local</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">pol_over_hor</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                    <span class="s2">&quot;aby,bcxy,cdy-&gt;adxy&quot;</span><span class="p">,</span>
                    <span class="n">rotation_matrix_T</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">coherency_radec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">full_pol_over_hor</span><span class="p">],</span>
                    <span class="n">rotation_matrix</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">coherency_local</span></div>

<div class="viewcode-block" id="SkyModel.select"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">component_inds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downselect data to keep on the object along various axes.</span>

<span class="sd">        Currently this only supports downselecting based on the component axis,</span>
<span class="sd">        but this will be expanded to support other axes as well.</span>

<span class="sd">        The history attribute on the object will be updated to identify the</span>
<span class="sd">        operations performed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        component_inds : array_like of int</span>
<span class="sd">            Component indices to keep on the object.</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            Option to perform the select directly on self or return a new SkyModel</span>
<span class="sd">            object with just the selected data (the default is True, meaning the</span>
<span class="sd">            select will be done on self).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">skyobj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skyobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">component_inds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">skyobj</span>
            <span class="k">return</span>

        <span class="n">new_ncomponents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">component_inds</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">new_ncomponents</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Select would result in an empty object.&quot;</span><span class="p">)</span>

        <span class="n">skyobj</span><span class="o">.</span><span class="n">Ncomponents</span> <span class="o">=</span> <span class="n">new_ncomponents</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">hpx_inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">hpx_inds</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">hpx_inds</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>
        <span class="n">skyobj</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>
        <span class="n">skyobj</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">dec</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">reference_frequency</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">spectral_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">spectral_index</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">spectral_index</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>
        <span class="n">skyobj</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">stokes</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">component_inds</span><span class="p">]</span>
        <span class="n">skyobj</span><span class="o">.</span><span class="n">coherency_radec</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">coherency_radec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">beam_amp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">beam_amp</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">beam_amp</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">extended_model_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">extended_model_group</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">extended_model_group</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">alt_az</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">alt_az</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">alt_az</span><span class="p">[:,</span> <span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">pos_lmn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">pos_lmn</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">pos_lmn</span><span class="p">[:,</span> <span class="n">component_inds</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">above_horizon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">above_horizon</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">above_horizon</span><span class="p">[</span><span class="n">component_inds</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">run_check</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">skyobj</span></div>

<div class="viewcode-block" id="SkyModel.source_cuts"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.source_cuts">[docs]</a>    <span class="k">def</span> <span class="nf">source_cuts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">latitude_deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">horizon_buffer</span><span class="o">=</span><span class="mf">0.04364</span><span class="p">,</span>
        <span class="n">min_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">freq_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform flux and horizon selections.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        latitude_deg : float</span>
<span class="sd">            Latitude of telescope in degrees. Used to estimate rise/set lst.</span>
<span class="sd">        horizon_buffer : float</span>
<span class="sd">            Angle buffer for coarse horizon cut in radians.</span>
<span class="sd">            Default is about 10 minutes of sky rotation. Components whose</span>
<span class="sd">            calculated altitude is less than `horizon_buffer` are excluded.</span>
<span class="sd">            Caution! The altitude calculation does not account for</span>
<span class="sd">            precession/nutation of the Earth.</span>
<span class="sd">            The buffer angle is needed to ensure that the horizon cut doesn&#39;t</span>
<span class="sd">            exclude sources near but above the horizon. Since the cutoff is</span>
<span class="sd">            done using lst, and the lsts are calculated with astropy, the</span>
<span class="sd">            required buffer should _not_ drift with time since the J2000 epoch.</span>
<span class="sd">            The default buffer has been tested around julian date 2457458.0.</span>
<span class="sd">        min_flux : float</span>
<span class="sd">            Minimum stokes I flux to select [Jy]</span>
<span class="sd">        max_flux : float</span>
<span class="sd">            Maximum stokes I flux to select [Jy]</span>
<span class="sd">        freq_range : :class:`astropy.Quantity`</span>
<span class="sd">            Frequency range over which the min and max flux tests should be performed.</span>
<span class="sd">            Must be length 2. If None, use the range over which the object is defined.</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            Option to do the cuts on the object in place or to return a copy</span>
<span class="sd">            with the cuts applied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coarse_horizon_cut</span> <span class="o">=</span> <span class="n">latitude_deg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">skyobj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skyobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">freq_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq_range</span><span class="p">,</span> <span class="p">(</span><span class="n">Quantity</span><span class="p">,)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;freq_range must be an astropy Quantity.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">freq_range</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;freq_range must have 2 elements.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">min_flux</span> <span class="ow">or</span> <span class="n">max_flux</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;spectral_index&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Flux cuts with spectral index type objects is not supported yet.&quot;</span>
                <span class="p">)</span>

            <span class="n">freq_inds_use</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">freq_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">freqs_inds_use</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">skyobj</span><span class="o">.</span><span class="n">freq_array</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">freq_range</span><span class="p">))</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">skyobj</span><span class="o">.</span><span class="n">freq_array</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">freq_range</span><span class="p">))</span>
                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">freqs_inds_use</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No frequencies in freq_range.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">freqs_inds_use</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">skyobj</span><span class="o">.</span><span class="n">Nfreqs</span><span class="p">)</span>

            <span class="c1"># just cut on Stokes I</span>
            <span class="k">if</span> <span class="n">min_flux</span><span class="p">:</span>
                <span class="n">comp_inds_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">skyobj</span><span class="o">.</span><span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_inds_use</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">min_flux</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">skyobj</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">component_inds</span><span class="o">=</span><span class="n">comp_inds_to_keep</span><span class="p">,</span> <span class="n">run_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">max_flux</span><span class="p">:</span>
                <span class="n">comp_inds_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">skyobj</span><span class="o">.</span><span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_inds_use</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_flux</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">skyobj</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">component_inds</span><span class="o">=</span><span class="n">comp_inds_to_keep</span><span class="p">,</span> <span class="n">run_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">coarse_horizon_cut</span><span class="p">:</span>
            <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude_deg</span><span class="p">)</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="n">horizon_buffer</span>

            <span class="n">tans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">skyobj</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">rad</span><span class="p">)</span>
            <span class="n">nonrising</span> <span class="o">=</span> <span class="n">tans</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>

            <span class="n">comp_inds_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="o">~</span><span class="n">nonrising</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">component_inds</span><span class="o">=</span><span class="n">comp_inds_to_keep</span><span class="p">,</span> <span class="n">run_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">tans</span> <span class="o">=</span> <span class="n">tans</span><span class="p">[</span><span class="o">~</span><span class="n">nonrising</span><span class="p">]</span>

            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                    <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;invalid value encountered&quot;</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">rise_lst</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">rad</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tans</span><span class="p">)</span> <span class="o">-</span> <span class="n">buff</span>
                <span class="n">set_lst</span> <span class="o">=</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">rad</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tans</span><span class="p">)</span> <span class="o">+</span> <span class="n">buff</span>

                <span class="n">rise_lst</span><span class="p">[</span><span class="n">rise_lst</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">set_lst</span><span class="p">[</span><span class="n">set_lst</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">rise_lst</span><span class="p">[</span><span class="n">rise_lst</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">set_lst</span><span class="p">[</span><span class="n">set_lst</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">skyobj</span><span class="o">.</span><span class="n">_rise_lst</span> <span class="o">=</span> <span class="n">rise_lst</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">_set_lst</span> <span class="o">=</span> <span class="n">set_lst</span>

        <span class="k">if</span> <span class="n">run_check</span><span class="p">:</span>
            <span class="n">skyobj</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">skyobj</span></div>

<div class="viewcode-block" id="SkyModel.to_recarray"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.to_recarray">[docs]</a>    <span class="k">def</span> <span class="nf">to_recarray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a recarray of source components from this object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        catalog_table : recarray</span>
<span class="sd">            recarray equivalent to SkyModel data.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This stores all SkyModel data in a contiguous array</span>
<span class="sd">        that can be more easily handled with numpy.</span>
<span class="sd">        This is used by pyuvsim for sharing catalog data via MPI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_use</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;nside&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nside</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpx_inds</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">max_name_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">name_use</span><span class="p">])</span>
        <span class="n">fieldtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;U&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_name_len</span><span class="p">),</span> <span class="s2">&quot;f8&quot;</span><span class="p">,</span> <span class="s2">&quot;f8&quot;</span><span class="p">]</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ra_j2000&quot;</span><span class="p">,</span> <span class="s2">&quot;dec_j2000&quot;</span><span class="p">]</span>
        <span class="c1"># Alias &quot;flux_density_&quot; for &quot;I&quot;, etc.</span>
        <span class="n">stokes_names</span> <span class="o">=</span> <span class="p">[(</span><span class="sa">f</span><span class="s2">&quot;flux_density_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">]]</span>
        <span class="n">fieldshapes</span> <span class="o">=</span> <span class="p">[()]</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="n">fieldshapes</span> <span class="o">=</span> <span class="p">[()]</span> <span class="o">*</span> <span class="mi">3</span>

        <span class="n">n_stokes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stokes_keep</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">si</span><span class="p">,</span> <span class="n">total</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stokes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stokes_names</span><span class="p">[</span><span class="n">si</span><span class="p">])</span>
                <span class="n">fieldshapes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nfreqs</span><span class="p">,))</span>
                <span class="n">fieldtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;f8&quot;</span><span class="p">)</span>
                <span class="n">n_stokes</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stokes_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">n_stokes</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;No components with nonzero flux.&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;subband&quot;</span><span class="p">:</span>
                <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;subband_frequency&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span>
            <span class="n">fieldtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;f8&quot;</span><span class="p">)</span>
            <span class="n">fieldshapes</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nfreqs</span><span class="p">,)])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># add frequency field (a copy of reference_frequency) for backwards</span>
            <span class="c1"># compatibility.</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The reference_frequency is aliased as `frequency` in the recarray &quot;</span>
                <span class="s2">&quot;for backwards compatibility. In the future &quot;</span>
                <span class="s2">&quot;only `reference_frequency` will be an accepted column key.&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fieldnames</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;reference_frequency&quot;</span><span class="p">)])</span>
            <span class="n">fieldtypes</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;f8&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">fieldshapes</span><span class="o">.</span><span class="n">extend</span><span class="p">([()]</span> <span class="o">*</span> <span class="n">n_stokes</span> <span class="o">+</span> <span class="p">[()]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;spectral_index&quot;</span><span class="p">)</span>
                <span class="n">fieldtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;f8&quot;</span><span class="p">)</span>
                <span class="n">fieldshapes</span><span class="o">.</span><span class="n">append</span><span class="p">(())</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_rise_lst&quot;</span><span class="p">):</span>
            <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rise_lst&quot;</span><span class="p">)</span>
            <span class="n">fieldtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;f8&quot;</span><span class="p">)</span>
            <span class="n">fieldshapes</span><span class="o">.</span><span class="n">append</span><span class="p">(())</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_set_lst&quot;</span><span class="p">):</span>
            <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;set_lst&quot;</span><span class="p">)</span>
            <span class="n">fieldtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;f8&quot;</span><span class="p">)</span>
            <span class="n">fieldshapes</span><span class="o">.</span><span class="n">append</span><span class="p">(())</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">,</span> <span class="n">fieldtypes</span><span class="p">,</span> <span class="n">fieldshapes</span><span class="p">)))</span>

        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_use</span>
        <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;ra_j2000&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span>
        <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;dec_j2000&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stokes_keep</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">stokes_names</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;subband&quot;</span><span class="p">:</span>
                <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;subband_frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;spectral_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_index</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_rise_lst&quot;</span><span class="p">):</span>
            <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;rise_lst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rise_lst</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_set_lst&quot;</span><span class="p">):</span>
            <span class="n">arr</span><span class="p">[</span><span class="s2">&quot;set_lst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_lst</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;recarray flux columns will no longer be labeled&quot;</span>
            <span class="s2">&quot; `flux_density_I` etc. in the future. Use `I` instead.&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">arr</span></div>

<div class="viewcode-block" id="SkyModel.from_recarray"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.from_recarray">[docs]</a>    <span class="k">def</span> <span class="nf">from_recarray</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recarray_in</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize this object from a recarray.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        recarray_in : recarray</span>
<span class="sd">            recarray to turn into a SkyModel object.</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">Longitude</span><span class="p">(</span><span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;ra_j2000&quot;</span><span class="p">],</span> <span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">Latitude</span><span class="p">(</span><span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;dec_j2000&quot;</span><span class="p">],</span> <span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="n">Ncomponents</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">size</span>

        <span class="n">rise_lst</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">set_lst</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">recarray_in</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="k">if</span> <span class="s2">&quot;reference_frequency&quot;</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">:</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;reference_frequency&quot;</span><span class="p">]),</span> <span class="s2">&quot;hertz&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;spectral_index&quot;</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">:</span>
                <span class="n">spectral_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;spectral_index&quot;</span><span class="p">])</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;spectral_index&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;flat&quot;</span>
                <span class="n">spectral_index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="n">fieldnames</span> <span class="ow">or</span> <span class="s2">&quot;subband_frequency&quot;</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">:</span>
                <span class="n">freq_array</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]),</span> <span class="s2">&quot;hertz&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;subband&quot;</span>
                <span class="n">freq_array</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;subband_frequency&quot;</span><span class="p">]),</span> <span class="s2">&quot;hertz&quot;</span>
                <span class="p">)</span>
            <span class="c1"># freq_array gets copied for every component, so its zeroth axis is</span>
            <span class="c1"># length Ncomponents. Just take the first one.</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="n">freq_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">if</span> <span class="n">freq_array</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;subband_frequency&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">:</span>
                    <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;full&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;flat&quot;</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">spectral_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># flat spectrum, no freq info</span>
            <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;flat&quot;</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">spectral_index</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;rise_lst&quot;</span> <span class="ow">in</span> <span class="n">recarray_in</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">rise_lst</span> <span class="o">=</span> <span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;rise_lst&quot;</span><span class="p">]</span>
            <span class="n">set_lst</span> <span class="o">=</span> <span class="n">recarray_in</span><span class="p">[</span><span class="s2">&quot;set_lst&quot;</span><span class="p">]</span>

        <span class="c1"># Read Stokes parameters</span>
        <span class="n">Nfreqs</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">freq_array</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_array</span><span class="o">.</span><span class="n">size</span>
        <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">Nfreqs</span><span class="p">,</span> <span class="n">Ncomponents</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">spar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">spar</span> <span class="ow">in</span> <span class="n">recarray_in</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">stokes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">recarray_in</span><span class="p">[</span><span class="n">spar</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;nside&quot;</span><span class="p">):</span>
            <span class="n">nside</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;nside&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)])</span>
            <span class="n">hpx_inds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
            <span class="n">names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">ids</span>
            <span class="n">nside</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hpx_inds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
            <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
            <span class="n">stokes</span><span class="o">=</span><span class="n">stokes</span><span class="p">,</span>
            <span class="n">spectral_type</span><span class="o">=</span><span class="n">spectral_type</span><span class="p">,</span>
            <span class="n">freq_array</span><span class="o">=</span><span class="n">freq_array</span><span class="p">,</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="n">reference_frequency</span><span class="p">,</span>
            <span class="n">spectral_index</span><span class="o">=</span><span class="n">spectral_index</span><span class="p">,</span>
            <span class="n">nside</span><span class="o">=</span><span class="n">nside</span><span class="p">,</span>
            <span class="n">hpx_inds</span><span class="o">=</span><span class="n">hpx_inds</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">rise_lst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rise_lst</span> <span class="o">=</span> <span class="n">rise_lst</span>
        <span class="k">if</span> <span class="n">set_lst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_lst</span> <span class="o">=</span> <span class="n">set_lst</span>

        <span class="k">if</span> <span class="n">run_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SkyModel.read_healpix_hdf5"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.read_healpix_hdf5">[docs]</a>    <span class="k">def</span> <span class="nf">read_healpix_hdf5</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hdf5_filename</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read hdf5 healpix files into this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdf5_filename : str</span>
<span class="sd">            Path and name of the hdf5 file to read.</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Currently, this function only converts a HEALPix map with a frequency axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">astropy_healpix</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;The astropy-healpix module must be installed to use HEALPix methods&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileobj</span><span class="p">:</span>
            <span class="n">hpmap</span> <span class="o">=</span> <span class="n">fileobj</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># Remove Nskies axis.</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">fileobj</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">][()]</span>
            <span class="n">freqs</span> <span class="o">=</span> <span class="n">fileobj</span><span class="p">[</span><span class="s2">&quot;freqs&quot;</span><span class="p">][()]</span>
            <span class="n">history</span> <span class="o">=</span> <span class="n">fileobj</span><span class="p">[</span><span class="s2">&quot;history&quot;</span><span class="p">][()]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">history</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nside</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fileobj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;nside&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">nside</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">astropy_healpix</span><span class="o">.</span><span class="n">npix_to_nside</span><span class="p">(</span><span class="n">hpmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">astropy_healpix</span><span class="o">.</span><span class="n">healpix_to_lonlat</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">nside</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="s2">&quot;hertz&quot;</span><span class="p">)</span>
        <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)))</span>
        <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hpmap</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">skyutils</span><span class="o">.</span><span class="n">jy_to_ksr</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">astropy_healpix</span><span class="o">.</span><span class="n">nside_to_pixel_area</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">nside</span><span class="o">=</span><span class="n">nside</span><span class="p">,</span>
            <span class="n">hpx_inds</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
            <span class="n">stokes</span><span class="o">=</span><span class="n">stokes</span><span class="p">,</span>
            <span class="n">spectral_type</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
            <span class="n">freq_array</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyradiosky_version_str</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">uvutils</span><span class="o">.</span><span class="n">_check_history_version</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyradiosky_version_str</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyradiosky_version_str</span>

        <span class="k">if</span> <span class="n">run_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
            <span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="SkyModel.read_votable_catalog"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.read_votable_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">read_votable_catalog</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">votable_file</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">,</span>
        <span class="n">id_column</span><span class="p">,</span>
        <span class="n">ra_column</span><span class="p">,</span>
        <span class="n">dec_column</span><span class="p">,</span>
        <span class="n">flux_columns</span><span class="p">,</span>
        <span class="n">reference_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">freq_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">spectral_index_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">source_select_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a votable catalog file into this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        votable_file : str</span>
<span class="sd">            Path to votable catalog file.</span>
<span class="sd">        table_name : str</span>
<span class="sd">            Part of expected table name. Should match only one table name in votable_file.</span>
<span class="sd">        id_column : str</span>
<span class="sd">            Part of expected ID column. Should match only one column in the table.</span>
<span class="sd">        ra_column : str</span>
<span class="sd">            Part of expected RA column. Should match only one column in the table.</span>
<span class="sd">        dec_column : str</span>
<span class="sd">            Part of expected Dec column. Should match only one column in the table.</span>
<span class="sd">        flux_columns : str or list of str</span>
<span class="sd">            Part of expected Flux column(s). Each one should match only one column in the table.</span>
<span class="sd">        reference_frequency : :class:`astropy.Quantity`</span>
<span class="sd">            Reference frequency for flux values, assumed to be the same value for all rows.</span>
<span class="sd">        freq_array : :class:`astropy.Quantity`</span>
<span class="sd">            Frequencies corresponding to flux_columns (should be same length).</span>
<span class="sd">            Required for multiple flux columns.</span>
<span class="sd">        return_table : bool, optional</span>
<span class="sd">            Whether to return the astropy table instead of a list of Source objects.</span>
<span class="sd">        source_select_kwds : dict, optional</span>
<span class="sd">            Dictionary of keywords for source selection Valid options:</span>

<span class="sd">            * `lst_array`: For coarse RA horizon cuts, lsts used in the simulation [radians]</span>
<span class="sd">            * `latitude_deg`: Latitude of telescope in degrees. Used for declination coarse</span>
<span class="sd">               horizon cut.</span>
<span class="sd">            * `horizon_buffer`: Angle (float, in radians) of buffer for coarse horizon cut.</span>
<span class="sd">              Default is about 10 minutes of sky rotation. (See caveats in</span>
<span class="sd">              :func:`~skymodel.SkyModel.source_cuts` docstring)</span>
<span class="sd">            * `min_flux`: Minimum stokes I flux to select [Jy]</span>
<span class="sd">            * `max_flux`: Maximum stokes I flux to select [Jy]</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_vo</span> <span class="o">=</span> <span class="n">votable</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">votable_file</span><span class="p">)</span>

        <span class="n">tables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parsed_vo</span><span class="o">.</span><span class="n">iter_tables</span><span class="p">())</span>
        <span class="n">table_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">_ID</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span>
        <span class="n">table_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span>

        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">table_name_use</span> <span class="o">=</span> <span class="n">_get_matching_fields</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">table_ids</span><span class="p">)</span>
                <span class="n">table_match</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">table</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span> <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">_ID</span> <span class="o">==</span> <span class="n">table_name_use</span>
                <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">table_name_use</span> <span class="o">=</span> <span class="n">_get_matching_fields</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">table_names</span><span class="p">)</span>
                <span class="n">table_match</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">table</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span> <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">table_name_use</span>
                <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">votable_file</span><span class="si">}</span><span class="s2"> contains tables with no name or ID, Support for &quot;</span>
                <span class="s2">&quot;such files is deprecated.&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Find correct table using the field names</span>
            <span class="n">tables_match</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="n">id_col_use</span> <span class="o">=</span> <span class="n">_get_matching_fields</span><span class="p">(</span>
                    <span class="n">id_column</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span> <span class="n">brittle</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">id_col_use</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tables_match</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables_match</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;More than one matching table.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">table_match</span> <span class="o">=</span> <span class="n">tables_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Convert to astropy Table</span>
        <span class="n">astropy_table</span> <span class="o">=</span> <span class="n">table_match</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>

        <span class="c1"># get ID column</span>
        <span class="n">id_col_use</span> <span class="o">=</span> <span class="n">_get_matching_fields</span><span class="p">(</span><span class="n">id_column</span><span class="p">,</span> <span class="n">astropy_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>

        <span class="c1"># get RA &amp; Dec columns, if multiple matches, exclude VizieR calculated columns</span>
        <span class="c1"># which start with an underscore</span>
        <span class="n">ra_col_use</span> <span class="o">=</span> <span class="n">_get_matching_fields</span><span class="p">(</span>
            <span class="n">ra_column</span><span class="p">,</span> <span class="n">astropy_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span> <span class="n">exclude_start_pattern</span><span class="o">=</span><span class="s2">&quot;_&quot;</span>
        <span class="p">)</span>
        <span class="n">dec_col_use</span> <span class="o">=</span> <span class="n">_get_matching_fields</span><span class="p">(</span>
            <span class="n">dec_column</span><span class="p">,</span> <span class="n">astropy_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span> <span class="n">exclude_start_pattern</span><span class="o">=</span><span class="s2">&quot;_&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flux_columns</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="n">flux_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">flux_columns</span><span class="p">]</span>
        <span class="n">flux_cols_use</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">flux_columns</span><span class="p">:</span>
            <span class="n">flux_cols_use</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_get_matching_fields</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">astropy_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux_columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">freq_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;freq_array must be provided for multiple flux columns.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux_cols_use</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_frequency</span><span class="p">,</span> <span class="p">(</span><span class="n">Quantity</span><span class="p">,)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;reference_frequency must be an astropy Quantity.&quot;</span><span class="p">)</span>
                <span class="n">reference_frequency</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">reference_frequency</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">astropy_table</span><span class="p">))</span>
                    <span class="o">*</span> <span class="n">reference_frequency</span><span class="o">.</span><span class="n">unit</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">spectral_index_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;spectral_index&quot;</span>
                <span class="n">spec_index_col_use</span> <span class="o">=</span> <span class="n">_get_matching_fields</span><span class="p">(</span>
                    <span class="n">spectral_index_column</span><span class="p">,</span> <span class="n">astropy_table</span><span class="o">.</span><span class="n">colnames</span>
                <span class="p">)</span>
                <span class="n">spectral_index</span> <span class="o">=</span> <span class="n">astropy_table</span><span class="p">[</span><span class="n">spec_index_col_use</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;flat&quot;</span>
                <span class="n">spectral_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;subband&quot;</span>
            <span class="n">spectral_index</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux_cols_use</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">astropy_table</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flux_cols_use</span><span class="p">):</span>
            <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">astropy_table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">astropy_table</span><span class="p">[</span><span class="n">id_col_use</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">),</span>
            <span class="n">ra</span><span class="o">=</span><span class="n">Longitude</span><span class="p">(</span>
                <span class="n">astropy_table</span><span class="p">[</span><span class="n">ra_col_use</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">astropy_table</span><span class="p">[</span><span class="n">ra_col_use</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
            <span class="p">),</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">Latitude</span><span class="p">(</span>
                <span class="n">astropy_table</span><span class="p">[</span><span class="n">dec_col_use</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">astropy_table</span><span class="p">[</span><span class="n">dec_col_use</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
            <span class="p">),</span>
            <span class="n">stokes</span><span class="o">=</span><span class="n">stokes</span><span class="p">,</span>
            <span class="n">spectral_type</span><span class="o">=</span><span class="n">spectral_type</span><span class="p">,</span>
            <span class="n">freq_array</span><span class="o">=</span><span class="n">freq_array</span><span class="p">,</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="n">reference_frequency</span><span class="p">,</span>
            <span class="n">spectral_index</span><span class="o">=</span><span class="n">spectral_index</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">source_select_kwds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_cuts</span><span class="p">(</span><span class="o">**</span><span class="n">source_select_kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">run_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
            <span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="SkyModel.read_gleam_catalog"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.read_gleam_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">read_gleam_catalog</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gleam_file</span><span class="p">,</span>
        <span class="n">spectral_type</span><span class="o">=</span><span class="s2">&quot;flat&quot;</span><span class="p">,</span>
        <span class="n">source_select_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the GLEAM votable catalog file into this object.</span>

<span class="sd">        Tested on: GLEAM EGC catalog, version 2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gleam_file : str</span>
<span class="sd">            Path to GLEAM votable catalog file.</span>
<span class="sd">        spectral_type : str</span>
<span class="sd">            One of &#39;flat&#39;, &#39;subband&#39; or &#39;spectral_index&#39;. If set to &#39;flat&#39;, the</span>
<span class="sd">            wide band integrated flux will be used, if set to &#39;spectral_index&#39; the</span>
<span class="sd">            fitted flux at 200 MHz will be used for the flux column.</span>
<span class="sd">        return_table : bool, optional</span>
<span class="sd">            Whether to return the astropy table instead of a SkyModel object.</span>
<span class="sd">        source_select_kwds : dict, optional</span>
<span class="sd">            Dictionary of keywords for source selection Valid options:</span>

<span class="sd">            * `lst_array`: For coarse RA horizon cuts, lsts used in the simulation [radians]</span>
<span class="sd">            * `latitude_deg`: Latitude of telescope in degrees. Used for declination coarse</span>
<span class="sd">               horizon cut.</span>
<span class="sd">            * `horizon_buffer`: Angle (float, in radians) of buffer for coarse horizon cut.</span>
<span class="sd">              Default is about 10 minutes of sky rotation. (See caveats in</span>
<span class="sd">              :func:`array_to_skymodel` docstring)</span>
<span class="sd">            * `min_flux`: Minimum stokes I flux to select [Jy]</span>
<span class="sd">            * `max_flux`: Maximum stokes I flux to select [Jy]</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spec_type_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="s2">&quot;spectral_index&quot;</span><span class="p">,</span> <span class="s2">&quot;subband&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">spectral_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec_type_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;spectral_type </span><span class="si">{</span><span class="n">spectral_type</span><span class="si">}</span><span class="s2"> is not an allowed type. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Allowed types are: </span><span class="si">{</span><span class="n">spec_type_list</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;flat&quot;</span><span class="p">:</span>
            <span class="n">flux_columns</span> <span class="o">=</span> <span class="s2">&quot;Fintwide&quot;</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="mf">200e6</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">spectral_index_column</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;spectral_index&quot;</span><span class="p">:</span>
            <span class="n">flux_columns</span> <span class="o">=</span> <span class="s2">&quot;Fintfit200&quot;</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="mf">200e6</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
            <span class="n">spectral_index_column</span> <span class="o">=</span> <span class="s2">&quot;alpha&quot;</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fmt: off</span>
            <span class="n">flux_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Fint076&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint084&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint092&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint099&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint107&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Fint115&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint122&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint130&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint143&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint151&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Fint158&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint166&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint174&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint181&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint189&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Fint197&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint204&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint212&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint220&quot;</span><span class="p">,</span> <span class="s2">&quot;Fint227&quot;</span><span class="p">]</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span>
                          <span class="mi">174</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">227</span><span class="p">]</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq_array</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">spectral_index_column</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># fmt: on</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_votable_catalog</span><span class="p">(</span>
            <span class="n">gleam_file</span><span class="p">,</span>
            <span class="s2">&quot;GLEAM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GLEAM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RAJ2000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DEJ2000&quot;</span><span class="p">,</span>
            <span class="n">flux_columns</span><span class="o">=</span><span class="n">flux_columns</span><span class="p">,</span>
            <span class="n">freq_array</span><span class="o">=</span><span class="n">freq_array</span><span class="p">,</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="n">reference_frequency</span><span class="p">,</span>
            <span class="n">spectral_index_column</span><span class="o">=</span><span class="n">spectral_index_column</span><span class="p">,</span>
            <span class="n">source_select_kwds</span><span class="o">=</span><span class="n">source_select_kwds</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="SkyModel.read_text_catalog"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.read_text_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">read_text_catalog</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">catalog_csv</span><span class="p">,</span>
        <span class="n">source_select_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a text file of sources into this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        catalog_csv: str</span>
<span class="sd">            Path to tab separated value file with the following required columns:</span>
<span class="sd">            *  `Source_ID`: source name as a string of maximum 10 characters</span>
<span class="sd">            *  `ra_j2000`: right ascension at J2000 epoch, in decimal degrees</span>
<span class="sd">            *  `dec_j2000`: declination at J2000 epoch, in decimal degrees</span>
<span class="sd">            *  `Flux [Jy]`: Stokes I flux density in Janskys</span>

<span class="sd">            If flux is specified at multiple frequencies (must be the same set for all</span>
<span class="sd">            components), the frequencies must be included in each column name,</span>
<span class="sd">            e.g. `Flux at 150 MHz [Jy]`. Recognized units are (&#39;Hz&#39;, &#39;kHz&#39;, &#39;MHz&#39; or &#39;GHz&#39;):</span>

<span class="sd">            If flux is only specified at one reference frequency (can be different per</span>
<span class="sd">            component), a frequency column should be added (note: assumed to be in Hz):</span>
<span class="sd">            *  `Frequency`: reference frequency [Hz]</span>

<span class="sd">            Optionally a spectral index can be specified per component with:</span>
<span class="sd">            *  `Spectral_Index`: spectral index</span>

<span class="sd">        source_select_kwds : dict, optional</span>
<span class="sd">            Dictionary of keywords for source selection. Valid options:</span>

<span class="sd">            * `lst_array`: For coarse RA horizon cuts, lsts used in the simulation [radians]</span>
<span class="sd">            * `latitude_deg`: Latitude of telescope in degrees. Used for declination coarse</span>
<span class="sd">            *  horizon cut.</span>
<span class="sd">            * `horizon_buffer`: Angle (float, in radians) of buffer for coarse horizon cut.</span>
<span class="sd">              Default is about 10 minutes of sky rotation. (See caveats in</span>
<span class="sd">              :func:`array_to_skymodel` docstring)</span>
<span class="sd">            * `min_flux`: Minimum stokes I flux to select [Jy]</span>
<span class="sd">            * `max_flux`: Maximum stokes I flux to select [Jy]</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">catalog_csv</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfile</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">cfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span>
        <span class="p">]</span>  <span class="c1"># Ignore units in header</span>

        <span class="n">flux_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">colname</span> <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">header</span> <span class="k">if</span> <span class="n">colname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;flux&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">flux_fields_lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">colname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">flux_fields</span><span class="p">]</span>

        <span class="n">header_lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">colname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">header</span><span class="p">]</span>

        <span class="n">expected_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ra_j2000&quot;</span><span class="p">,</span> <span class="s2">&quot;dec_j2000&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="n">header_lower</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux_fields</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;If frequency column is present, only one flux column allowed.&quot;</span>
                <span class="p">)</span>
            <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">expected_cols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">flux_fields_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;frequency&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;spectral_index&quot;</span> <span class="ow">in</span> <span class="n">header_lower</span><span class="p">:</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;spectral_index&quot;</span>
                <span class="n">expected_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;spectral_index&quot;</span><span class="p">)</span>
                <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;flat&quot;</span>
            <span class="n">n_freqs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frequencies</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">fluxname</span> <span class="ow">in</span> <span class="n">flux_fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;Hz&quot;</span> <span class="ow">in</span> <span class="n">fluxname</span><span class="p">:</span>
                    <span class="n">cst_obj</span> <span class="o">=</span> <span class="n">CSTBeam</span><span class="p">()</span>
                    <span class="n">freq</span> <span class="o">=</span> <span class="n">cst_obj</span><span class="o">.</span><span class="n">name2freq</span><span class="p">(</span><span class="n">fluxname</span><span class="p">)</span>
                    <span class="n">frequencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux_fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Multiple flux fields, but they do not all contain a frequency.&quot;</span>
                        <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n_freqs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;subband&quot;</span> <span class="ow">in</span> <span class="n">flux_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;subband&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;full&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;flat&quot;</span>
                <span class="c1"># This has a freq_array</span>
                <span class="n">expected_cols</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flux_fields_lower</span><span class="p">)</span>
                <span class="n">freq_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This is a flat spectrum (no freq info)</span>
                <span class="n">n_freqs</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">spectral_type</span> <span class="o">=</span> <span class="s2">&quot;flat&quot;</span>
                <span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">expected_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;flux&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">expected_cols</span> <span class="o">!=</span> <span class="n">header_lower</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Header does not match expectations. Expected columns&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;are: </span><span class="si">{</span><span class="n">expected_cols</span><span class="si">}</span><span class="s2">, header columns were: </span><span class="si">{</span><span class="n">header_lower</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">catalog_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span>
            <span class="n">catalog_csv</span><span class="p">,</span> <span class="n">autostrip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
        <span class="p">)</span>

        <span class="n">catalog_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">catalog_table</span><span class="p">)</span>

        <span class="n">col_names</span> <span class="o">=</span> <span class="n">catalog_table</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>

        <span class="n">names</span> <span class="o">=</span> <span class="n">catalog_table</span><span class="p">[</span><span class="n">col_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
        <span class="n">ras</span> <span class="o">=</span> <span class="n">Longitude</span><span class="p">(</span><span class="n">catalog_table</span><span class="p">[</span><span class="n">col_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">decs</span> <span class="o">=</span> <span class="n">Latitude</span><span class="p">(</span><span class="n">catalog_table</span><span class="p">[</span><span class="n">col_names</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>

        <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">n_freqs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog_table</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_freqs</span><span class="p">):</span>
            <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">catalog_table</span><span class="p">[</span><span class="n">col_names</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]]</span>

        <span class="k">if</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="n">header_lower</span> <span class="ow">and</span> <span class="n">freq_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">freq_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">header_lower</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="n">catalog_table</span><span class="p">[</span><span class="n">col_names</span><span class="p">[</span><span class="n">freq_ind</span><span class="p">]]</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
            <span class="k">if</span> <span class="s2">&quot;spectral_index&quot;</span> <span class="ow">in</span> <span class="n">header_lower</span><span class="p">:</span>
                <span class="n">si_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">header_lower</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;spectral_index&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">spectral_index</span> <span class="o">=</span> <span class="n">catalog_table</span><span class="p">[</span><span class="n">col_names</span><span class="p">[</span><span class="n">si_ind</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectral_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reference_frequency</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">spectral_index</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
            <span class="n">ra</span><span class="o">=</span><span class="n">ras</span><span class="p">,</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">decs</span><span class="p">,</span>
            <span class="n">stokes</span><span class="o">=</span><span class="n">stokes</span><span class="p">,</span>
            <span class="n">spectral_type</span><span class="o">=</span><span class="n">spectral_type</span><span class="p">,</span>
            <span class="n">freq_array</span><span class="o">=</span><span class="n">freq_array</span><span class="p">,</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="n">reference_frequency</span><span class="p">,</span>
            <span class="n">spectral_index</span><span class="o">=</span><span class="n">spectral_index</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">source_select_kwds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_cuts</span><span class="p">(</span><span class="o">**</span><span class="n">source_select_kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">run_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
            <span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="SkyModel.read_idl_catalog"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.read_idl_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">read_idl_catalog</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename_sav</span><span class="p">,</span>
        <span class="n">expand_extended</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">source_select_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_extra</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_check_acceptability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in an FHD-readable IDL .sav file catalog.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename_sav: str</span>
<span class="sd">            Path to IDL .sav file.</span>

<span class="sd">        expand_extended: bool</span>
<span class="sd">            If True, return extended source components.</span>
<span class="sd">            Default: True</span>
<span class="sd">        source_select_kwds : dict, optional</span>
<span class="sd">            Dictionary of keywords for source selection. Valid options:</span>

<span class="sd">            * `lst_array`: For coarse RA horizon cuts, lsts used in the simulation [radians]</span>
<span class="sd">            * `latitude_deg`: Latitude of telescope in degrees. Used for declination coarse</span>
<span class="sd">            *  horizon cut.</span>
<span class="sd">            * `horizon_buffer`: Angle (float, in radians) of buffer for coarse horizon cut.</span>
<span class="sd">              Default is about 10 minutes of sky rotation. (See caveats in</span>
<span class="sd">              :func:`array_to_skymodel` docstring)</span>
<span class="sd">            * `min_flux`: Minimum stokes I flux to select [Jy]</span>
<span class="sd">            * `max_flux`: Maximum stokes I flux to select [Jy]</span>
<span class="sd">        run_check : bool</span>
<span class="sd">            Option to check for the existence and proper shapes of parameters</span>
<span class="sd">            after downselecting data on this object (the default is True,</span>
<span class="sd">            meaning the check will be run).</span>
<span class="sd">        check_extra : bool</span>
<span class="sd">            Option to check optional parameters as well as required ones (the</span>
<span class="sd">            default is True, meaning the optional parameters will be checked).</span>
<span class="sd">        run_check_acceptability : bool</span>
<span class="sd">            Option to check acceptable range of the values of parameters after</span>
<span class="sd">            downselecting data on this object (the default is True, meaning the</span>
<span class="sd">            acceptable range check will be done).</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">readsav</span><span class="p">(</span><span class="n">filename_sav</span><span class="p">)[</span><span class="s2">&quot;catalog&quot;</span><span class="p">]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">]</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">]</span>
        <span class="n">source_freqs</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
        <span class="n">spectral_index</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>
        <span class="n">Nsrcs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
        <span class="n">extended_model_group</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Nsrcs</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;BEAM&quot;</span> <span class="ow">in</span> <span class="n">catalog</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">use_beam_amps</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">beam_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">Nsrcs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_beam_amps</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">beam_amp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">Nsrcs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nsrcs</span><span class="p">):</span>
            <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;I&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stokes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stokes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;U&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stokes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;V&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">use_beam_amps</span><span class="p">:</span>
                <span class="n">beam_amp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;XX&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">beam_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;YY&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">beam_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;XY&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">beam_amp</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;YX&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">expand_extended</span><span class="p">:</span>
            <span class="n">ext_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">[</span><span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;extend&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nsrcs</span><span class="p">)]</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">source_group_id</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext_inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Add components and preserve ordering</span>
                <span class="n">source_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Nsrcs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">ext_inds</span><span class="p">:</span>
                    <span class="n">use_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">source_inds</span> <span class="o">==</span> <span class="n">ext</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">source_id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">use_index</span><span class="p">]</span>
                    <span class="c1"># Remove top-level source information</span>
                    <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">stokes</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">source_freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">source_freqs</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="n">spectral_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">spectral_index</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="n">source_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">source_inds</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="c1"># Add component information</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">ext</span><span class="p">][</span><span class="s2">&quot;extend&quot;</span><span class="p">]</span>
                    <span class="n">Ncomps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
                    <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Ncomps</span><span class="p">,</span> <span class="n">source_id</span><span class="p">))</span>
                    <span class="n">extended_model_group</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                        <span class="n">extended_model_group</span><span class="p">,</span>
                        <span class="n">use_index</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Ncomps</span><span class="p">,</span> <span class="n">source_group_id</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">source_group_id</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">])</span>
                    <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">])</span>
                    <span class="n">stokes_ext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">Ncomps</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">use_beam_amps</span><span class="p">:</span>
                        <span class="n">beam_amp_ext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">Ncomps</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ncomps</span><span class="p">):</span>
                        <span class="n">stokes_ext</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;I&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">stokes_ext</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">stokes_ext</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;U&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">stokes_ext</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;V&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">use_beam_amps</span><span class="p">:</span>
                            <span class="n">beam_amp_ext</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;XX&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">beam_amp_ext</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;YY&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">beam_amp_ext</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;XY&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">beam_amp_ext</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;YX&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                        <span class="p">(</span>  <span class="c1"># np.insert doesn&#39;t work with arrays</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">stokes</span><span class="p">[:,</span> <span class="p">:</span><span class="n">use_index</span><span class="p">],</span> <span class="n">stokes_ext</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                            <span class="n">stokes</span><span class="p">[:,</span> <span class="n">use_index</span><span class="p">:],</span>
                        <span class="p">),</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">use_beam_amps</span><span class="p">:</span>
                        <span class="n">beam_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                                    <span class="p">(</span><span class="n">beam_amp</span><span class="p">[:,</span> <span class="p">:</span><span class="n">use_index</span><span class="p">],</span> <span class="n">beam_amp_ext</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
                                <span class="p">),</span>
                                <span class="n">beam_amp</span><span class="p">[:,</span> <span class="n">use_index</span><span class="p">:],</span>
                            <span class="p">),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">source_freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">source_freqs</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">])</span>
                    <span class="n">spectral_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">spectral_index</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">src</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
                    <span class="n">source_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                        <span class="n">source_inds</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Ncomps</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="n">ra</span> <span class="o">=</span> <span class="n">Longitude</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">Latitude</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># Add frequency axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span>
            <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
            <span class="n">stokes</span><span class="o">=</span><span class="n">stokes</span><span class="p">,</span>
            <span class="n">spectral_type</span><span class="o">=</span><span class="s2">&quot;spectral_index&quot;</span><span class="p">,</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="n">Quantity</span><span class="p">(</span><span class="n">source_freqs</span><span class="p">,</span> <span class="s2">&quot;hertz&quot;</span><span class="p">),</span>
            <span class="n">spectral_index</span><span class="o">=</span><span class="n">spectral_index</span><span class="p">,</span>
            <span class="n">beam_amp</span><span class="o">=</span><span class="n">beam_amp</span><span class="p">,</span>
            <span class="n">extended_model_group</span><span class="o">=</span><span class="n">extended_model_group</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">source_select_kwds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_cuts</span><span class="p">(</span><span class="o">**</span><span class="n">source_select_kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">run_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                <span class="n">check_extra</span><span class="o">=</span><span class="n">check_extra</span><span class="p">,</span> <span class="n">run_check_acceptability</span><span class="o">=</span><span class="n">run_check_acceptability</span>
            <span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="SkyModel.write_healpix_hdf5"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.write_healpix_hdf5">[docs]</a>    <span class="k">def</span> <span class="nf">write_healpix_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a set of HEALPix maps to an HDF5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            Name of file to write to.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_type</span> <span class="o">!=</span> <span class="s2">&quot;healpix&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;component_type must be &#39;healpix&#39; to use this method.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
        <span class="n">hpmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span>
        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyradiosky_version_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">uvutils</span><span class="o">.</span><span class="n">_check_history_version</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyradiosky_version_str</span><span class="p">):</span>
                <span class="n">history</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyradiosky_version_str</span>

        <span class="n">valid_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Npix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ncomponents</span><span class="p">,</span>
            <span class="s2">&quot;nside&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nside</span><span class="p">,</span>
            <span class="s2">&quot;Nskies&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;Nfreqs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nfreqs</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">hpmap</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpx_inds</span><span class="p">,</span>
            <span class="s2">&quot;freqs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span><span class="p">,</span>
            <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="n">history</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">dsets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
            <span class="s2">&quot;freqs&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileobj</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_params</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">valid_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dsets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">fileobj</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dsets</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fileobj</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                            <span class="n">k</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">dsets</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                            <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
                            <span class="n">compression_opts</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fileobj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span></div>

<div class="viewcode-block" id="SkyModel.write_text_catalog"><a class="viewcode-back" href="../../skymodel.html#pyradiosky.SkyModel.write_text_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">write_text_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write out this object to a text file.</span>

<span class="sd">        Readable with :meth:`~skymodel.SkyModel.read_text_catalog()`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Path to output file (string)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_type</span> <span class="o">!=</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;component_type must be &#39;point&#39; to use this method.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>

        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;SOURCE_ID</span><span class="se">\t</span><span class="s2">RA_J2000 [deg]</span><span class="se">\t</span><span class="s2">Dec_J2000 [deg]&quot;</span>
        <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Flux [Jy]</span><span class="se">\t</span><span class="s2">Frequency [Hz]&quot;</span>
            <span class="n">format_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Spectral_Index&quot;</span>
                <span class="n">format_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span><span class="p">:</span>
                <span class="n">freq_hz_val</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">freq_hz_val</span> <span class="o">&gt;</span> <span class="mf">1e9</span><span class="p">:</span>
                    <span class="n">freq_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">_GHz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq_hz_val</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">freq_hz_val</span> <span class="o">&gt;</span> <span class="mf">1e6</span><span class="p">:</span>
                    <span class="n">freq_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">_MHz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq_hz_val</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">freq_hz_val</span> <span class="o">&gt;</span> <span class="mf">1e3</span><span class="p">:</span>
                    <span class="n">freq_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">_kHz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq_hz_val</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">freq_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">_Hz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq_hz_val</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_type</span> <span class="o">==</span> <span class="s2">&quot;subband&quot;</span><span class="p">:</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Flux_subband_</span><span class="si">{</span><span class="n">freq_str</span><span class="si">}</span><span class="s2"> [Jy]&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Flux_</span><span class="si">{</span><span class="n">freq_str</span><span class="si">}</span><span class="s2"> [Jy]&quot;</span>
                <span class="n">format_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># flat spectral response, no freq info</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Flux [Jy]&quot;</span>
            <span class="n">format_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span>

        <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">format_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fo</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_recarray</span><span class="p">()</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
                <span class="n">fieldvals</span> <span class="o">=</span> <span class="n">src</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">,</span> <span class="n">fieldvals</span><span class="p">))</span>
                <span class="n">srcid</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">]</span>
                <span class="n">ra</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;ra_j2000&quot;</span><span class="p">]</span>
                <span class="n">dec</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;dec_j2000&quot;</span><span class="p">]</span>
                <span class="n">flux_i</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">rfreq</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;reference_frequency&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">spec_index</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;spectral_index&quot;</span><span class="p">]</span>
                        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">srcid</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="o">*</span><span class="n">flux_i</span><span class="p">,</span> <span class="n">rfreq</span><span class="p">,</span> <span class="n">spec_index</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">srcid</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="o">*</span><span class="n">flux_i</span><span class="p">,</span> <span class="n">rfreq</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">srcid</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="o">*</span><span class="n">flux_i</span><span class="p">))</span></div></div>


<span class="k">def</span> <span class="nf">read_healpix_hdf5</span><span class="p">(</span><span class="n">hdf5_filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read hdf5 healpix files using h5py and get a healpix map, indices and frequencies.</span>

<span class="sd">    Deprecated. Use `_read_healpix_hdf5` instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hdf5_filename : str</span>
<span class="sd">        Path and name of the hdf5 file to read.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hpmap : array_like of float</span>
<span class="sd">        Stokes-I surface brightness in K, for a set of pixels</span>
<span class="sd">        Shape (Ncomponents, Nfreqs)</span>
<span class="sd">    indices : array_like, int</span>
<span class="sd">        Corresponding HEALPix indices for hpmap.</span>
<span class="sd">    freqs : array_like, float</span>
<span class="sd">        Frequencies in Hz. Shape (Nfreqs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.read_healpix_hdf5` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileobj</span><span class="p">:</span>
        <span class="n">hpmap</span> <span class="o">=</span> <span class="n">fileobj</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># Remove Nskies axis.</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">fileobj</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">][()]</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">fileobj</span><span class="p">[</span><span class="s2">&quot;freqs&quot;</span><span class="p">][()]</span>

    <span class="k">return</span> <span class="n">hpmap</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">freqs</span>


<span class="k">def</span> <span class="nf">write_healpix_hdf5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hpmap</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">nside</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a set of HEALPix maps to an HDF5 file.</span>

<span class="sd">    Deprecated. Use `SkyModel.write_healpix_hdf5` instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename: str</span>
<span class="sd">        Name of file to write to.</span>
<span class="sd">    hpmap: array_like of float</span>
<span class="sd">        Pixel values in Kelvin. Shape (Nfreqs, Npix)</span>
<span class="sd">    indices: array_like of int</span>
<span class="sd">        HEALPix pixel indices corresponding with axis 1 of hpmap.</span>
<span class="sd">    freqs: array_like of floats</span>
<span class="sd">        Frequencies in Hz corresponding with axis 0 of hpmap.</span>
<span class="sd">    nside: int</span>
<span class="sd">        nside parameter of the map. Optional if the hpmap covers</span>
<span class="sd">        the full sphere (i.e., has no missing pixels), since the nside</span>
<span class="sd">        can be inferred from the map size.</span>
<span class="sd">    history: str</span>
<span class="sd">        Optional history string to include in the file.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">astropy_healpix</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;The astropy-healpix module must be installed to use HEALPix methods&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.write_healpix_hdf5` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">Nfreqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="o">.</span><span class="n">size</span>
    <span class="n">Npix</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nside</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nside</span> <span class="o">=</span> <span class="n">astropy_healpix</span><span class="o">.</span><span class="n">npix_to_nside</span><span class="p">(</span><span class="n">Npix</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need to provide nside if giving a subset of the map.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">hpmap</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">Nfreqs</span><span class="p">,</span> <span class="n">Npix</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid map shape </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hpmap</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">history</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">valid_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Npix&quot;</span><span class="p">:</span> <span class="n">Npix</span><span class="p">,</span>
        <span class="s2">&quot;nside&quot;</span><span class="p">:</span> <span class="n">nside</span><span class="p">,</span>
        <span class="s2">&quot;Nskies&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Nfreqs&quot;</span><span class="p">:</span> <span class="n">Nfreqs</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">hpmap</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">indices</span><span class="p">,</span>
        <span class="s2">&quot;freqs&quot;</span><span class="p">:</span> <span class="n">freqs</span><span class="p">,</span>
        <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="n">history</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">dsets</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
        <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
        <span class="s2">&quot;freqs&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
        <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileobj</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_params</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">valid_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dsets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                    <span class="n">fileobj</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dsets</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fileobj</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                        <span class="n">k</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">dsets</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                        <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
                        <span class="n">compression_opts</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fileobj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">healpix_to_sky</span><span class="p">(</span><span class="n">hpmap</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">freqs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a healpix map in K to a set of point source components in Jy.</span>

<span class="sd">    Deprecated. Use SkyModel.read_healpix_hdf5 instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hpmap : array_like of float</span>
<span class="sd">        Stokes-I surface brightness in K, for a set of pixels</span>
<span class="sd">        Shape (Nfreqs, Ncomponents)</span>
<span class="sd">    indices : array_like, int</span>
<span class="sd">        Corresponding HEALPix indices for hpmap.</span>
<span class="sd">    freqs : array_like, float</span>
<span class="sd">        Frequencies in Hz. Shape (Nfreqs)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sky : :class:`SkyModel`</span>
<span class="sd">        The sky model created from the healpix map.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Currently, this function only converts a HEALPix map with a frequency axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">astropy_healpix</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;The astropy-healpix module must be installed to use HEALPix methods&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.read_healpix_hdf5` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">nside</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">astropy_healpix</span><span class="o">.</span><span class="n">npix_to_nside</span><span class="p">(</span><span class="n">hpmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">astropy_healpix</span><span class="o">.</span><span class="n">healpix_to_lonlat</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">nside</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="s2">&quot;hertz&quot;</span><span class="p">)</span>
    <span class="n">stokes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)))</span>
    <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hpmap</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">skyutils</span><span class="o">.</span><span class="n">jy_to_ksr</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stokes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">astropy_healpix</span><span class="o">.</span><span class="n">nside_to_pixel_area</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>

    <span class="n">sky</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span>
        <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
        <span class="n">stokes</span><span class="o">=</span><span class="n">stokes</span><span class="p">,</span>
        <span class="n">spectral_type</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
        <span class="n">freq_array</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
        <span class="n">nside</span><span class="o">=</span><span class="n">nside</span><span class="p">,</span>
        <span class="n">hpx_inds</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">sky</span>


<span class="k">def</span> <span class="nf">skymodel_to_array</span><span class="p">(</span><span class="n">sky</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a recarray of source components from a SkyModel object.</span>

<span class="sd">    Deprecated. Use `SkyModel.to_recarray` instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sky : :class:`pyradiosky.SkyModel`</span>
<span class="sd">        SkyModel object to convert to a recarray.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    catalog_table : recarray</span>
<span class="sd">        recarray equivalent to SkyModel data.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This stores all SkyModel data in a contiguous array</span>
<span class="sd">    that can be more easily handled with numpy.</span>
<span class="sd">    This is used by pyuvsim for sharing catalog data via MPI.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.to_recarray` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">sky</span><span class="o">.</span><span class="n">to_recarray</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">array_to_skymodel</span><span class="p">(</span><span class="n">catalog_table</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a SkyModel object from a recarray.</span>

<span class="sd">    Deprecated. Use `SkyModel.from_recarray` instead.&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    catalog_table : recarray</span>
<span class="sd">        recarray to turn into a SkyModel object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`pyradiosky.SkyModel`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.from_recarray` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">skyobj</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">()</span>
    <span class="n">skyobj</span><span class="o">.</span><span class="n">from_recarray</span><span class="p">(</span><span class="n">catalog_table</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">skyobj</span>


<span class="k">def</span> <span class="nf">source_cuts</span><span class="p">(</span>
    <span class="n">catalog_table</span><span class="p">,</span>
    <span class="n">latitude_deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">horizon_buffer</span><span class="o">=</span><span class="mf">0.04364</span><span class="p">,</span>
    <span class="n">min_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">freq_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform flux and horizon selections on recarray of source components.</span>

<span class="sd">    Deprecated. Use `SkyModel.source_cuts` instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    catalog_table : recarray</span>
<span class="sd">        recarray of source catalog information. Must have the columns:</span>
<span class="sd">        &#39;source_id&#39;, &#39;ra_j2000&#39;, &#39;dec_j2000&#39;, &#39;flux_density&#39;</span>
<span class="sd">        may also have the colums:</span>
<span class="sd">        &#39;frequency&#39; or &#39;reference_frequency&#39;</span>
<span class="sd">    latitude_deg : float</span>
<span class="sd">        Latitude of telescope in degrees. Used to estimate rise/set lst.</span>
<span class="sd">    horizon_buffer : float</span>
<span class="sd">        Angle buffer for coarse horizon cut in radians.</span>
<span class="sd">        Default is about 10 minutes of sky rotation. `SkyModel`</span>
<span class="sd">        components whose calculated altitude is less than `horizon_buffer` are excluded.</span>
<span class="sd">        Caution! The altitude calculation does not account for precession/nutation of the Earth.</span>
<span class="sd">        The buffer angle is needed to ensure that the horizon cut doesn&#39;t exclude sources near</span>
<span class="sd">        but above the horizon. Since the cutoff is done using lst, and the lsts are calculated</span>
<span class="sd">        with astropy, the required buffer should _not_ drift with time since the J2000 epoch.</span>
<span class="sd">        The default buffer has been tested around julian date 2457458.0.</span>
<span class="sd">    min_flux : float</span>
<span class="sd">        Minimum stokes I flux to select [Jy]</span>
<span class="sd">    max_flux : float</span>
<span class="sd">        Maximum stokes I flux to select [Jy]</span>
<span class="sd">    freq_range : :class:`astropy.Quantity`</span>
<span class="sd">        Frequency range over which the min and max flux tests should be performed.</span>
<span class="sd">        Must be length 2. If None, use the range over which the object is defined.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    recarray</span>
<span class="sd">        A new recarray of source components, with additional columns for rise and set lst.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.source_cuts` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">skyobj</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">()</span>
    <span class="n">skyobj</span><span class="o">.</span><span class="n">from_recarray</span><span class="p">(</span><span class="n">catalog_table</span><span class="p">)</span>
    <span class="n">skyobj</span><span class="o">.</span><span class="n">source_cuts</span><span class="p">(</span>
        <span class="n">latitude_deg</span><span class="o">=</span><span class="n">latitude_deg</span><span class="p">,</span>
        <span class="n">horizon_buffer</span><span class="o">=</span><span class="n">horizon_buffer</span><span class="p">,</span>
        <span class="n">min_flux</span><span class="o">=</span><span class="n">min_flux</span><span class="p">,</span>
        <span class="n">max_flux</span><span class="o">=</span><span class="n">max_flux</span><span class="p">,</span>
        <span class="n">freq_range</span><span class="o">=</span><span class="n">freq_range</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">to_recarray</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">read_votable_catalog</span><span class="p">(</span>
    <span class="n">votable_file</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;GLEAM&quot;</span><span class="p">,</span>
    <span class="n">id_column</span><span class="o">=</span><span class="s2">&quot;GLEAM&quot;</span><span class="p">,</span>
    <span class="n">ra_column</span><span class="o">=</span><span class="s2">&quot;RAJ2000&quot;</span><span class="p">,</span>
    <span class="n">dec_column</span><span class="o">=</span><span class="s2">&quot;DEJ2000&quot;</span><span class="p">,</span>
    <span class="n">flux_columns</span><span class="o">=</span><span class="s2">&quot;Fintwide&quot;</span><span class="p">,</span>
    <span class="n">reference_frequency</span><span class="o">=</span><span class="mf">200e6</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">Hz</span><span class="p">,</span>
    <span class="n">freq_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">spectral_index_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">source_select_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">return_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a SkyModel object from a votable catalog.</span>

<span class="sd">    Deprecated. Use `SkyModel.read_votable_catalog` instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    votable_file : str</span>
<span class="sd">        Path to votable catalog file.</span>
<span class="sd">    table_name : str</span>
<span class="sd">        Part of expected table name. Should match only one table name in votable_file.</span>
<span class="sd">    id_column : str</span>
<span class="sd">        Part of expected ID column. Should match only one column in the table.</span>
<span class="sd">    ra_column : str</span>
<span class="sd">        Part of expected RA column. Should match only one column in the table.</span>
<span class="sd">    dec_column : str</span>
<span class="sd">        Part of expected Dec column. Should match only one column in the table.</span>
<span class="sd">    flux_columns : str or list of str</span>
<span class="sd">        Part of expected Flux column(s). Each one should match only one column in the table.</span>
<span class="sd">    reference_frequency : :class:`astropy.Quantity`</span>
<span class="sd">        Reference frequency for flux values, assumed to be the same value for all rows.</span>
<span class="sd">    freq_array : :class:`astropy.Quantity`</span>
<span class="sd">        Frequencies corresponding to flux_columns (should be same length).</span>
<span class="sd">        Required for multiple flux columns.</span>
<span class="sd">    return_table : bool, optional</span>
<span class="sd">        Whether to return the astropy table instead of a list of Source objects.</span>
<span class="sd">    source_select_kwds : dict, optional</span>
<span class="sd">        Dictionary of keywords for source selection Valid options:</span>

<span class="sd">        * `lst_array`: For coarse RA horizon cuts, lsts used in the simulation [radians]</span>
<span class="sd">        * `latitude_deg`: Latitude of telescope in degrees. Used for declination coarse</span>
<span class="sd">           horizon cut.</span>
<span class="sd">        * `horizon_buffer`: Angle (float, in radians) of buffer for coarse horizon cut.</span>
<span class="sd">          Default is about 10 minutes of sky rotation. (See caveats in</span>
<span class="sd">          :func:`array_to_skymodel` docstring)</span>
<span class="sd">        * `min_flux`: Minimum stokes I flux to select [Jy]</span>
<span class="sd">        * `max_flux`: Maximum stokes I flux to select [Jy]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    recarray or :class:`pyradiosky.SkyModel`</span>
<span class="sd">        if return_table, recarray of source parameters, otherwise :class:`pyradiosky.SkyModel` instance</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.read_votable_catalog` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">skyobj</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">()</span>
    <span class="n">skyobj</span><span class="o">.</span><span class="n">read_votable_catalog</span><span class="p">(</span>
        <span class="n">votable_file</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">,</span>
        <span class="n">id_column</span><span class="p">,</span>
        <span class="n">ra_column</span><span class="p">,</span>
        <span class="n">dec_column</span><span class="p">,</span>
        <span class="n">flux_columns</span><span class="p">,</span>
        <span class="n">reference_frequency</span><span class="o">=</span><span class="n">reference_frequency</span><span class="p">,</span>
        <span class="n">freq_array</span><span class="o">=</span><span class="n">freq_array</span><span class="p">,</span>
        <span class="n">spectral_index_column</span><span class="o">=</span><span class="n">spectral_index_column</span><span class="p">,</span>
        <span class="n">source_select_kwds</span><span class="o">=</span><span class="n">source_select_kwds</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">return_table</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">to_recarray</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">skyobj</span>


<span class="k">def</span> <span class="nf">read_gleam_catalog</span><span class="p">(</span>
    <span class="n">gleam_file</span><span class="p">,</span> <span class="n">spectral_type</span><span class="o">=</span><span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">source_select_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_table</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a SkyModel object from the GLEAM votable catalog.</span>

<span class="sd">    Deprecated. Use `SkyModel.read_gleam_catalog` instead.</span>

<span class="sd">    Tested on: GLEAM EGC catalog, version 2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gleam_file : str</span>
<span class="sd">        Path to GLEAM votable catalog file.</span>
<span class="sd">    spectral_type : str</span>
<span class="sd">        One of &#39;flat&#39;, &#39;subband&#39; or &#39;spectral_index&#39;. If set to &#39;flat&#39;, the</span>
<span class="sd">        wide band integrated flux will be used, if set to &#39;spectral_index&#39; the</span>
<span class="sd">        fitted flux at 200 MHz will be used for the flux column.</span>
<span class="sd">    return_table : bool, optional</span>
<span class="sd">        Whether to return the astropy table instead of a SkyModel object.</span>
<span class="sd">    source_select_kwds : dict, optional</span>
<span class="sd">        Dictionary of keywords for source selection Valid options:</span>

<span class="sd">        * `lst_array`: For coarse RA horizon cuts, lsts used in the simulation [radians]</span>
<span class="sd">        * `latitude_deg`: Latitude of telescope in degrees. Used for declination coarse</span>
<span class="sd">           horizon cut.</span>
<span class="sd">        * `horizon_buffer`: Angle (float, in radians) of buffer for coarse horizon cut.</span>
<span class="sd">          Default is about 10 minutes of sky rotation. (See caveats in</span>
<span class="sd">          :func:`array_to_skymodel` docstring)</span>
<span class="sd">        * `min_flux`: Minimum stokes I flux to select [Jy]</span>
<span class="sd">        * `max_flux`: Maximum stokes I flux to select [Jy]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    recarray or :class:`pyradiosky.SkyModel`</span>
<span class="sd">        if return_table, recarray of source parameters, otherwise :class:`pyradiosky.SkyModel` instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.read_gleam_catalog` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">skyobj</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">()</span>
    <span class="n">skyobj</span><span class="o">.</span><span class="n">read_gleam_catalog</span><span class="p">(</span>
        <span class="n">gleam_file</span><span class="p">,</span> <span class="n">spectral_type</span><span class="o">=</span><span class="n">spectral_type</span><span class="p">,</span> <span class="n">source_select_kwds</span><span class="o">=</span><span class="n">source_select_kwds</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">return_table</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">to_recarray</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">skyobj</span>


<span class="k">def</span> <span class="nf">read_text_catalog</span><span class="p">(</span><span class="n">catalog_csv</span><span class="p">,</span> <span class="n">source_select_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_table</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a text file of sources.</span>

<span class="sd">    Deprecated. Use `SkyModel.read_text_catalog` instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    catalog_csv: str</span>
<span class="sd">        Path to tab separated value file with the following required columns:</span>
<span class="sd">        *  `Source_ID`: source name as a string of maximum 10 characters</span>
<span class="sd">        *  `ra_j2000`: right ascension at J2000 epoch, in decimal degrees</span>
<span class="sd">        *  `dec_j2000`: declination at J2000 epoch, in decimal degrees</span>
<span class="sd">        *  `Flux [Jy]`: Stokes I flux density in Janskys</span>

<span class="sd">        If flux is specified at multiple frequencies (must be the same set for all</span>
<span class="sd">        components), the frequencies must be included in each column name,</span>
<span class="sd">        e.g. `Flux at 150 MHz [Jy]`. Recognized units are (&#39;Hz&#39;, &#39;kHz&#39;, &#39;MHz&#39; or &#39;GHz&#39;):</span>

<span class="sd">        If flux is only specified at one reference frequency (can be different per</span>
<span class="sd">        component), a frequency column should be added (note: assumed to be in Hz):</span>
<span class="sd">        *  `Frequency`: reference frequency [Hz]</span>

<span class="sd">        Optionally a spectral index can be specified per component with:</span>
<span class="sd">        *  `Spectral_Index`: spectral index</span>

<span class="sd">    source_select_kwds : dict, optional</span>
<span class="sd">        Dictionary of keywords for source selection. Valid options:</span>

<span class="sd">        * `lst_array`: For coarse RA horizon cuts, lsts used in the simulation [radians]</span>
<span class="sd">        * `latitude_deg`: Latitude of telescope in degrees. Used for declination coarse</span>
<span class="sd">        *  horizon cut.</span>
<span class="sd">        * `horizon_buffer`: Angle (float, in radians) of buffer for coarse horizon cut.</span>
<span class="sd">          Default is about 10 minutes of sky rotation. (See caveats in</span>
<span class="sd">          :func:`array_to_skymodel` docstring)</span>
<span class="sd">        * `min_flux`: Minimum stokes I flux to select [Jy]</span>
<span class="sd">        * `max_flux`: Maximum stokes I flux to select [Jy]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sky_model : :class:`SkyModel`</span>
<span class="sd">        A sky model created from the text catalog.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.read_text_catalog` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">skyobj</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">()</span>
    <span class="n">skyobj</span><span class="o">.</span><span class="n">read_text_catalog</span><span class="p">(</span>
        <span class="n">catalog_csv</span><span class="p">,</span> <span class="n">source_select_kwds</span><span class="o">=</span><span class="n">source_select_kwds</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">return_table</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">skyobj</span><span class="o">.</span><span class="n">to_recarray</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">skyobj</span>


<span class="k">def</span> <span class="nf">read_idl_catalog</span><span class="p">(</span><span class="n">filename_sav</span><span class="p">,</span> <span class="n">expand_extended</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in an FHD-readable IDL .sav file catalog.</span>

<span class="sd">    Deprecated. Use `SkyModel.read_idl_catalog` instead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename_sav: str</span>
<span class="sd">        Path to IDL .sav file.</span>

<span class="sd">    expand_extended: bool</span>
<span class="sd">        If True, return extended source components.</span>
<span class="sd">        Default: True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`pyradiosky.SkyModel`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.read_idl_catalog` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">skyobj</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">()</span>
    <span class="n">skyobj</span><span class="o">.</span><span class="n">read_idl_catalog</span><span class="p">(</span>
        <span class="n">filename_sav</span><span class="p">,</span> <span class="n">expand_extended</span><span class="o">=</span><span class="n">expand_extended</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">skyobj</span>


<span class="k">def</span> <span class="nf">write_catalog_to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">skymodel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write out a catalog to a text file.</span>

<span class="sd">    Readable with :meth:`read_text_catalog()`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Path to output file (string)</span>
<span class="sd">    skymodel : :class:`SkyModel`</span>
<span class="sd">        The sky model to write to file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;This function is deprecated, use `SkyModel.write_text_catalog` instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">skymodel</span><span class="o">.</span><span class="n">write_text_catalog</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">pyradiosky</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../skymodel_parameters.html">SkyModel Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../skymodel.html">SkyModel Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utility_functions.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_docs.html">Developer Docs</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Radio Astronomy Software Group.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>